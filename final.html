<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>狗熊会人才计划第三期——My Case</title>
  <meta name="description" content="人才计划TASK &amp; Final Project。">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="狗熊会人才计划第三期——My Case" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="人才计划TASK &amp; Final Project。" />
  <meta name="github-repo" content="yihui/bookdown-chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="狗熊会人才计划第三期——My Case" />
  
  <meta name="twitter:description" content="人才计划TASK &amp; Final Project。" />
  

<meta name="author" content="yimeng">


<meta name="date" content="2018-09-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="binomial.html">
<link rel="next" href="sound.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">狗熊会人才计划第三期</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#e887b4e8b0a2"><i class="fa fa-check"></i>致谢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> 狗熊会人才计划介绍</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#whats-that"><i class="fa fa-check"></i><b>1.1</b> 狗熊会，what’s that?!</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#omd"><i class="fa fa-check"></i><b>1.2</b> 人才计划，OMD!</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 人才计划导师天团</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="wind.html"><a href="wind.html"><i class="fa fa-check"></i><b>2</b> 人才计划章程</a><ul>
<li class="chapter" data-level="2.1" data-path="wind.html"><a href="wind.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 纪律</a></li>
<li class="chapter" data-level="2.2" data-path="wind.html"><a href="wind.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 禁止抄袭</a></li>
<li class="chapter" data-level="2.3" data-path="wind.html"><a href="wind.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 作业质量</a></li>
<li class="chapter" data-level="2.4" data-path="wind.html"><a href="wind.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 自学</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>3</b> TASK 1 背景介绍</a><ul>
<li class="chapter" data-level="3.1" data-path="background.html"><a href="background.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 学习资料</a></li>
<li class="chapter" data-level="3.2" data-path="background.html"><a href="background.html#good-work"><i class="fa fa-check"></i><b>3.2</b> Good Work</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> TASK 2 数据说明</a><ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>4.1</b> 学习资料</a></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 数据概览</a></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#good-work-1"><i class="fa fa-check"></i><b>4.3</b> Good Work</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>5</b> TASK 3 代码规范</a><ul>
<li class="chapter" data-level="5.1" data-path="code.html"><a href="code.html#-2"><i class="fa fa-check"></i><b>5.1</b> 学习资料</a><ul>
<li class="chapter" data-level="5.1.1" data-path="code.html"><a href="code.html#section-5.1.1"><i class="fa fa-check"></i><b>5.1.1</b> 注释篇</a></li>
<li class="chapter" data-level="5.1.2" data-path="code.html"><a href="code.html#section-5.1.2"><i class="fa fa-check"></i><b>5.1.2</b> 命名篇</a></li>
<li class="chapter" data-level="5.1.3" data-path="code.html"><a href="code.html#section-5.1.3"><i class="fa fa-check"></i><b>5.1.3</b> 函数模块化</a></li>
<li class="chapter" data-level="5.1.4" data-path="code.html"><a href="code.html#section-5.1.4"><i class="fa fa-check"></i><b>5.1.4</b> 纠错与调试</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="code.html"><a href="code.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 共享单车案例</a><ul>
<li class="chapter" data-level="5.2.1" data-path="code.html"><a href="code.html#section-5.2.1"><i class="fa fa-check"></i><b>5.2.1</b> 准备工作</a></li>
<li class="chapter" data-level="5.2.2" data-path="code.html"><a href="code.html#-"><i class="fa fa-check"></i><b>5.2.2</b> 分析报告 &amp; 代码</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="descriptive.html"><a href="descriptive.html"><i class="fa fa-check"></i><b>6</b> TASK 4 描述分析</a><ul>
<li class="chapter" data-level="6.1" data-path="descriptive.html"><a href="descriptive.html#-3"><i class="fa fa-check"></i><b>6.1</b> 学习资料</a></li>
<li class="chapter" data-level="6.2" data-path="descriptive.html"><a href="descriptive.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 题目</a></li>
<li class="chapter" data-level="6.3" data-path="descriptive.html"><a href="descriptive.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 探究影响消费金融贷款申请人数的因素——描述性分析</a><ul>
<li class="chapter" data-level="6.3.1" data-path="descriptive.html"><a href="descriptive.html#section-6.3.1"><i class="fa fa-check"></i><b>6.3.1</b> 对申请人数（因变量）进行描述</a></li>
<li class="chapter" data-level="6.3.2" data-path="descriptive.html"><a href="descriptive.html#section-6.3.2"><i class="fa fa-check"></i><b>6.3.2</b> 对借贷变量（自变量）进行描述</a></li>
<li class="chapter" data-level="6.3.3" data-path="descriptive.html"><a href="descriptive.html#section-6.3.3"><i class="fa fa-check"></i><b>6.3.3</b> 对还贷变量（自变量）进行描述</a></li>
<li class="chapter" data-level="6.3.4" data-path="descriptive.html"><a href="descriptive.html#section-6.3.4"><i class="fa fa-check"></i><b>6.3.4</b> 初步结论</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="descriptive.html"><a href="descriptive.html#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 代码</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="linear-model.html"><a href="linear-model.html"><i class="fa fa-check"></i><b>7</b> TASK 5 线性回归分析</a><ul>
<li class="chapter" data-level="7.1" data-path="linear-model.html"><a href="linear-model.html#-4"><i class="fa fa-check"></i><b>7.1</b> 学习资料</a></li>
<li class="chapter" data-level="7.2" data-path="linear-model.html"><a href="linear-model.html#section-7.2"><i class="fa fa-check"></i><b>7.2</b> 短租房热度案例</a><ul>
<li class="chapter" data-level="7.2.1" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>7.2.1</b> 准备工作</a></li>
<li class="chapter" data-level="7.2.2" data-path="linear-model.html"><a href="linear-model.html#--1"><i class="fa fa-check"></i><b>7.2.2</b> 分析报告 &amp; 代码</a></li>
<li class="chapter" data-level="7.2.3" data-path="linear-model.html"><a href="linear-model.html#section-7.2.3"><i class="fa fa-check"></i><b>7.2.3</b> 标准答案代码</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="binomial.html"><a href="binomial.html"><i class="fa fa-check"></i><b>8</b> TASK 6 分类问题</a><ul>
<li class="chapter" data-level="8.1" data-path="binomial.html"><a href="binomial.html#-5"><i class="fa fa-check"></i><b>8.1</b> 学习资料</a><ul>
<li class="chapter" data-level="8.1.1" data-path="binomial.html"><a href="binomial.html#section-8.1.1"><i class="fa fa-check"></i><b>8.1.1</b> 逻辑回归模型</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>8.2</b> 题目</a></li>
<li class="chapter" data-level="8.3" data-path="binomial.html"><a href="binomial.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> 影响消费贷款有效性的因素分析</a><ul>
<li class="chapter" data-level="8.3.1" data-path="binomial.html"><a href="binomial.html#section-8.3.1"><i class="fa fa-check"></i><b>8.3.1</b> 背景与研究问题</a></li>
<li class="chapter" data-level="8.3.2" data-path="binomial.html"><a href="binomial.html#section-8.3.2"><i class="fa fa-check"></i><b>8.3.2</b> 描述性分析</a></li>
<li class="chapter" data-level="8.3.3" data-path="binomial.html"><a href="binomial.html#section-8.3.3"><i class="fa fa-check"></i><b>8.3.3</b> 模型建立与选择</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>8.4</b> 代码</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="final.html"><a href="final.html"><i class="fa fa-check"></i><b>9</b> Fianl Project</a><ul>
<li class="chapter" data-level="9.1" data-path="final.html"><a href="final.html#slides"><i class="fa fa-check"></i><b>9.1</b> 作品Slides</a></li>
<li class="chapter" data-level="9.2" data-path="code.html"><a href="code.html#-2"><i class="fa fa-check"></i><b>9.2</b> 代码</a></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="sound.html"><a href="sound.html"><i class="fa fa-check"></i><b>A</b> 附录</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">狗熊会人才计划第三期——My Case</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="final" class="section level1">
<h1><span class="header-section-number">第 9 章</span> Fianl Project</h1>
<div id="slides" class="section level2">
<h2><span class="header-section-number">9.1</span> 作品Slides</h2>
<iframe seamless scrolling="no" style="width:100%;border-width:1px;border-style:solid;border-color:RGB(238, 238, 244)" frameborde="0" id="slide_one" src="https://melodyren1998.github.io/addtional-files/fina-project.html#1">
</iframe>
<script>
window.onload = function () {
  var node = document.getElementById('slide_one')
  node.style.height = parseInt(node.offsetWidth * 0.75) + 'px'
};
</script>
</div>
<div id="-2" class="section level2">
<h2><span class="header-section-number">9.2</span> 代码</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#环境设置#</span>
<span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())
<span class="kw">setwd</span>(<span class="st">&quot;D:/Melody_Ren/onedrive/Rworkspace/bearclub/final&quot;</span>) 
<span class="co"># dat0 &lt;- read_excel(&quot;final_data.xlsx&quot;)    #从网上爬下来的没有去重的数据</span>

<span class="co">#加载需要的程序包#</span>
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(readxl)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(viridis)
<span class="kw">library</span>(jiebaR)
<span class="kw">library</span>(wordcloud2)
<span class="kw">library</span>(reshape2)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(text2vec)
<span class="kw">library</span>(openxlsx)  
<span class="kw">library</span>(tmcn)

<span class="co">#背景描述#</span>
<span class="co">#绘图theme函数</span>
my_ggtheme &lt;-<span class="st"> </span><span class="cf">function</span>(){                            
  <span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span><span class="dv">18</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span><span class="dv">18</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span><span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span><span class="dv">20</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span><span class="kw">element_blank</span>(), <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>))
}
<span class="co">#数据来源于网络</span>
song &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;古典&quot;</span>,<span class="st">&quot;舞曲&quot;</span>,<span class="st">&quot;电音&quot;</span>,<span class="st">&quot;民谣&quot;</span>,<span class="st">&quot;爵士&quot;</span>,<span class="st">&quot;其他&quot;</span>,<span class="st">&quot;摇滚&quot;</span>,<span class="st">&quot;说唱&quot;</span>,<span class="st">&quot;R&amp;B&quot;</span>,<span class="st">&quot;流行&quot;</span>),
                   <span class="dt">like =</span> <span class="kw">c</span>(<span class="fl">0.74</span>,<span class="fl">5.67</span>,<span class="fl">20.44</span>,<span class="fl">14.19</span>,<span class="fl">1.26</span>,<span class="fl">11.55</span>,<span class="fl">7.24</span>,<span class="fl">3.05</span>,<span class="fl">5.72</span>,<span class="fl">30.14</span>))

<span class="kw">ggplot</span>(song, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(type, <span class="op">-</span><span class="st"> </span>like), <span class="dt">y =</span> like))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;音乐风格&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;用户偏好比例（%）&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()


<span class="co"># data process</span>

dat000 &lt;-<span class="st"> </span><span class="kw">read.xlsx</span>(<span class="st">&quot;final_data.xlsx&quot;</span>)  <span class="co"># 读取数据 </span>

<span class="co"># 处理文本</span>
dat000<span class="op">$</span>play_num =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;播放量：&#39;</span>, <span class="st">&#39;&#39;</span>, dat000<span class="op">$</span>play_num)
dat000<span class="op">$</span>collect_num =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;收藏量：&#39;</span>, <span class="st">&#39;&#39;</span>, dat000<span class="op">$</span>collect_num)
dat000<span class="op">$</span>comment =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;评论</span><span class="ch">\\</span><span class="st">(([0-9]+)</span><span class="ch">\\</span><span class="st">)&#39;</span>, <span class="st">&#39;</span><span class="ch">\\</span><span class="st">1&#39;</span>, dat000<span class="op">$</span>comment)
dat000<span class="op">$</span>album =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;专辑：&#39;</span>, <span class="st">&#39;&#39;</span>, dat000<span class="op">$</span>album)
dat000<span class="op">$</span>language =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;语种：&#39;</span>, <span class="st">&#39;&#39;</span>, dat000<span class="op">$</span>language)
dat000<span class="op">$</span>genre =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;流派：&#39;</span>, <span class="st">&#39;&#39;</span>, dat000<span class="op">$</span>genre)

<span class="co">#从album专辑列选出含有“语种”的数据</span>
wrong_language_index &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;^语种&quot;</span>,dat000<span class="op">$</span>album)                                     
dat000[wrong_language_index,<span class="st">&quot;language&quot;</span>] &lt;-<span class="st"> </span>dat000[wrong_language_index,<span class="st">&quot;album&quot;</span>] 
dat000[wrong_language_index,<span class="st">&quot;album&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span> 


<span class="co">#由于数据抓取是按照民谣歌单选择，而非直接对民谣歌手选择，因此数据包含较多流行歌手(I don&#39;t know why)，对一些明显不是民谣曲风的歌手进行手动剔除</span>
wrong_singer &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;周笔畅&quot;</span>,<span class="st">&quot;陈小春&quot;</span>,<span class="st">&quot;GAI&quot;</span>,<span class="st">&quot;G.E.M. 邓紫棋&quot;</span>,<span class="st">&quot;杨宗纬&quot;</span>,<span class="st">&quot;苏打绿&quot;</span>,<span class="st">&quot;莫文蔚&quot;</span>,<span class="st">&quot;李荣浩&quot;</span>,<span class="st">&quot;杨坤/郭采洁&quot;</span>,<span class="st">&quot;薛之谦&quot;</span>,<span class="st">&quot;陈奕迅&quot;</span>,<span class="st">&quot;许嵩&quot;</span>,<span class="st">&quot;五月天&quot;</span>, <span class="st">&quot;容祖儿&quot;</span>, <span class="st">&quot;王源&quot;</span>,<span class="st">&quot;孙燕姿&quot;</span>,<span class="st">&quot;陈小春&quot;</span>,<span class="st">&quot;梁静茹&quot;</span>,<span class="st">&quot;张惠妹&quot;</span>,<span class="st">&quot;汪苏泷&quot;</span>,<span class="st">&quot;徐良/汪苏泷&quot;</span>,<span class="st">&quot;林俊杰&quot;</span>,<span class="st">&quot;周杰伦&quot;</span>,<span class="st">&quot;范玮琪&quot;</span>,<span class="st">&quot;张杰&quot;</span>,<span class="st">&quot;范晓萱&quot;</span>,<span class="st">&quot;蔡健雅&quot;</span>,<span class="st">&quot;张杰&quot;</span>,<span class="st">&quot;周笔畅&quot;</span>,<span class="st">&quot;华晨宇&quot;</span>)
dat000 =<span class="st"> </span>dat000[<span class="op">!</span>dat000<span class="op">$</span>singer <span class="op">%in%</span><span class="st"> </span>wrong_singer, ]  <span class="co"># 删了100+行</span>


<span class="co"># 处理时间</span>
launch_time_df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">tstrsplit</span>(dat000<span class="op">$</span>launch_time, <span class="st">&#39;：&#39;</span>))
<span class="kw">colnames</span>(launch_time_df) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;time_type&quot;</span>,<span class="st">&quot;time&quot;</span>)
dat000 =<span class="st"> </span><span class="kw">cbind</span>(dat000, launch_time_df)
dat000<span class="op">$</span>launch_time =<span class="st"> </span><span class="ot">NULL</span>  <span class="co"># 删除原来不需要的列</span>

<span class="co"># 删除无评论的数据</span>
dat000<span class="op">$</span>comment =<span class="st"> </span><span class="kw">as.numeric</span>(dat000<span class="op">$</span>comment) 
dat000 =<span class="st"> </span>dat000[<span class="op">!</span><span class="kw">is.na</span>(dat000<span class="op">$</span>comment), ] <span class="co"># 删了347</span>

<span class="co"># colnames(dat000) &lt;- c(&#39;歌单名&#39;, &#39;播放量&#39;, &#39;收藏量&#39;, &#39;评论数&#39;, &#39;播放列表链接&#39;,</span>
<span class="co">#                     &#39;歌曲名&#39;, &#39;歌手&#39;, &#39;专辑&#39;, &#39;语种&#39;, &#39;流派&#39;, &#39;歌词&#39;, &#39;歌曲链接&#39;,</span>
<span class="co">#                     &#39;发行时间类型&#39;, &#39;发行时间&#39;)</span>

<span class="co">#选出语种符合要求的数据</span>
want_language &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;国语&quot;</span>,<span class="st">&quot; 纯音乐&quot;</span>,<span class="st">&quot; 粤语&quot;</span>,<span class="st">&quot; 其他&quot;</span>,<span class="st">&quot; 潮汕语&quot;</span>,<span class="st">&quot; 台语&quot;</span> )     <span class="co">#由于限定华语民谣，选出确实为华语的歌曲</span>
dat000<span class="op">$</span>language &lt;-<span class="st"> </span><span class="kw">as.character</span>(dat000<span class="op">$</span>language)
dat000 &lt;-<span class="st"> </span>dat000[<span class="kw">which</span>(dat000<span class="op">$</span>language <span class="op">%in%</span><span class="st"> </span>want_language),]  <span class="co"># 剩下3866行</span>

<span class="kw">write.csv</span>(dat000, <span class="dt">file=</span><span class="st">&quot;song.csv&quot;</span>, <span class="dt">row.names=</span><span class="ot">FALSE</span>)  <span class="co"># 经过清洗的数据，储存为song.csv</span>

<span class="co"># 提取歌曲id</span>

<span class="kw">library</span>(readr)<span class="co"># 读入数据</span>

dat0 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;song.csv&quot;</span>) 
<span class="co"># colnames(dat0) &lt;- c(&quot;list_name&quot;, &quot;play_num&quot;, &quot;collect_num&quot;, </span>
<span class="co">#                     &quot;comment&quot;, &quot;list_url&quot;, &quot;song_name&quot; , &quot;singer&quot;,</span>
<span class="co">#                     &quot;album&quot;, &quot;language&quot;, &quot;genre&quot;, &quot;lyrics&quot;, </span>
<span class="co">#                     &quot;song_url&quot;, &quot;time_type&quot;, &quot;time&quot;)</span>

<span class="co"># 抽取歌曲 id</span>
dat0<span class="op">$</span>song_id =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;https://y.qq.com/n/yqq/song/&#39;</span>, <span class="st">&#39;&#39;</span>, 
                    dat0<span class="op">$</span>song_url, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)
dat0<span class="op">$</span>song_id =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;.html&#39;</span>, <span class="st">&#39;&#39;</span>, dat0<span class="op">$</span>song_id, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)

<span class="co"># 按歌曲 id 去重</span>
song_index &lt;-<span class="st"> </span><span class="kw">duplicated</span>(dat0<span class="op">$</span>song_id) 
song_dat &lt;-<span class="st"> </span>dat0[<span class="op">!</span>song_index, ]

<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&#39;去重前数据有 %s 行，去重后剩余 %s 行。</span><span class="ch">\n</span><span class="st">&#39;</span>,
            <span class="kw">nrow</span>(dat0), <span class="kw">nrow</span>(song_dat)))

<span class="co"># 描述分析</span>
<span class="co"># 因变量分布图</span>
<span class="co"># 存在几首英文歌词的歌曲，视为脏数据剔除掉</span>
<span class="co"># song_dat &lt;- song_dat[- which(song_dat$language == &quot;英语&quot;),]</span>
<span class="co"># song_dat &lt;- song_dat[- which(song_dat$song_name == &quot;离家五百里&quot;),]</span>

<span class="kw">ggplot</span>(song_dat, <span class="kw">aes</span>(<span class="dt">x =</span> comment)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>) <span class="op">+</span><span class="st">             </span><span class="co"># 直方图</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(
                                                 <span class="co"># log变换</span>
    <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="fl">1e3</span>,<span class="fl">1e5</span>),                   
    <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;50&quot;</span>, <span class="st">&quot;1千&quot;</span>, <span class="st">&quot;10万&quot;</span>)
  ) <span class="op">+</span><span class="st">                                            </span><span class="co"># 对热度进行对数变换</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;评论数（对数变换）&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;频数&quot;</span>) <span class="op">+</span><span class="st">    </span><span class="co"># x轴y轴的label</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 流派和热度的关系</span>
song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>genre <span class="op">==</span><span class="st"> &quot;Alternative&quot;</span>),<span class="st">&quot;chinese&quot;</span>] &lt;-<span class="st"> &quot;其他&quot;</span>
song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>genre <span class="op">==</span><span class="st"> &quot;Folk&quot;</span>),<span class="st">&quot;chinese&quot;</span>] &lt;-<span class="st"> &quot;民谣&quot;</span>
song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>genre <span class="op">==</span><span class="st"> &quot;Rock&quot;</span>),<span class="st">&quot;chinese&quot;</span>] &lt;-<span class="st"> &quot;摇滚&quot;</span>
song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>genre <span class="op">==</span><span class="st"> &quot;Pop&quot;</span>),<span class="st">&quot;chinese&quot;</span>] &lt;-<span class="st"> &quot;流行&quot;</span>
song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>genre <span class="op">==</span><span class="st"> &quot;Soundtrack&quot;</span>),<span class="st">&quot;chinese&quot;</span>] &lt;-<span class="st"> &quot;原声音乐&quot;</span>
song_dt &lt;-<span class="st"> </span>song_dat[<span class="kw">complete.cases</span>(song_dat[,<span class="st">&quot;chinese&quot;</span>]),]  <span class="co">#删除流派的空值</span>

song_dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(song_dt)
song_dt[,chinese <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(chinese)]
song_dt[, genre_med <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">median</span>(<span class="kw">as.numeric</span>(comment)), by =<span class="st"> </span>chinese]
  
<span class="kw">ggplot</span>(song_dt, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(chinese, genre_med), <span class="dt">y =</span> <span class="kw">log</span>(comment))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">varwidth=</span><span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;chocolate4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;对数评论数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>() 

<span class="co"># 发行年份和热度的关系</span>
song_dat<span class="op">$</span>time &lt;-<span class="st"> </span><span class="kw">ymd</span>(song_dat<span class="op">$</span>time)
song_dat1 &lt;-<span class="st"> </span>song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>time_type <span class="op">==</span><span class="st"> &#39;发行时间&#39;</span>),]       <span class="co">#只看发行时间，不看上传时间</span>
song_dat1 &lt;-<span class="st"> </span>song_dat1[<span class="kw">complete.cases</span>(song_dat1[,<span class="st">&quot;time&quot;</span>]),]           <span class="co">#去除发行年份为空值的</span>

split_year_flag &lt;-<span class="st"> </span><span class="cf">function</span>(x){  <span class="co">#设置发行年份flag函数</span>
  <span class="cf">if</span> ((x <span class="op">&gt;</span><span class="st"> </span><span class="dv">1976</span>) <span class="op">&amp;</span><span class="st"> </span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">1990</span>)) <span class="kw">return</span>(<span class="st">&#39;1990年以前&#39;</span>)
  <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="dv">1995</span>)                <span class="kw">return</span>(<span class="st">&#39;1990-1995年&#39;)</span>
<span class="st">  if (x &lt; 2000)                return(&#39;</span><span class="dv">1995</span><span class="op">-</span><span class="dv">2000</span>年<span class="st">&#39;)</span>
<span class="st">  if (x &lt; 2005)                return(&#39;</span><span class="dv">2000</span><span class="op">-</span><span class="dv">2005</span>年<span class="st">&#39;)</span>
<span class="st">  if (x &lt; 2010)                return(&#39;</span><span class="dv">2005</span><span class="op">-</span><span class="dv">2010</span>年<span class="st">&#39;)</span>
<span class="st">  if (x &lt; 2015)                return(&#39;</span><span class="dv">2010</span><span class="op">-</span><span class="dv">2015</span>年<span class="st">&#39;)</span>
<span class="st">  return(&#39;</span><span class="dv">2015</span><span class="op">-</span><span class="dv">2018</span>年<span class="st">&#39;)</span>
<span class="st">}</span>
<span class="st">song_dat1$year_flag = sapply(year(song_dat1$time), split_year_flag)</span>

<span class="st">song_dat1 &lt;- data.table(song_dat1)</span>
<span class="st">song_dat1[, median_flag := median(as.numeric(comment)), by = &quot;year_flag&quot;]                    #给每个发行年份分组添加中位数标签</span>
<span class="st">ggplot(song_dat1, aes(x = reorder(year_flag, median_flag), y = log(comment)))+</span>
<span class="st">  geom_boxplot(varwidth=TRUE,fill = &quot;orange2&quot;, color = &quot;chocolate4&quot;)+</span>
<span class="st">  labs(x = &quot;&quot;,y = &quot;对数评论数&quot;) +</span>
<span class="st">  my_ggtheme() +</span>
<span class="st">  theme(axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5)) </span>

<span class="st">#民谣歌手热度TOP15#</span>
<span class="st"># song_dat1 &lt;- song_dat1[!song_dat1$singer %in% wrong_singer, ] #删除错误歌手之后的数据</span>
<span class="st">#这几个歌手是什么鬼啊 = =</span>
<span class="st">song_dat1 &lt;- song_dat1[c(-which(song_dat1$singer == &quot;大壮&quot;)),]</span>
<span class="st">song_dat1 &lt;- song_dat1[c(-which(song_dat1$singer == &quot;GALA&quot;)),]</span>
<span class="st">song_dat1 &lt;- song_dat1[c(-which(song_dat1$singer == &quot;刘若英&quot;)),]</span>
<span class="st">song_dat1 &lt;- song_dat1[c(-which(song_dat1$singer == &quot;于文文&quot;)),]</span>
<span class="st">song_dat1 &lt;- song_dat1[c(-which(song_dat1$singer == &quot;买辣椒也用券&quot;)),]</span>
<span class="st">song_dat1 &lt;- song_dat1[c(-which(song_dat1$singer == &quot;JC陈泳彤&quot;)),]</span>

<span class="st">top_singer &lt;- aggregate(comment~singer,data=song_dat1,sum)  %&gt;% as.data.frame()   #每个歌手的歌曲总热度</span>
<span class="st">top_singer_10 &lt;- top_singer[order(top_singer$comment, decreasing = TRUE),][1:10,]           #按照歌曲总热度从大到小排序</span>
<span class="st">#绘制不同歌手歌曲总热度条形图</span>
<span class="st">ggplot(top_singer_10, aes(x = reorder(singer, - comment), y = comment/10000)) +</span>
<span class="st">  geom_bar(stat = &quot;identity&quot;,fill = &quot;orange2&quot;) +</span>
<span class="st">  labs(x = &quot;歌手&quot;, y = &quot;总评论数量/万&quot;) +</span>
<span class="st">  my_ggtheme()</span>


<span class="st"># 文本分析</span>
<span class="st"># 去除作词作曲那些和最后的[展开]#</span>
<span class="st">song_dat$lyrics &lt;- as.character(song_dat$lyrics)</span>
<span class="st">for (i in 1:nrow(song_dat)){</span>
<span class="st">  a &lt;- strsplit(song_dat$lyrics[i], &#39;</span>\n<span class="st">&#39;)</span>
<span class="st">  delet_index &lt;- grep(&quot;-|：|展开&quot;,a[[1]])</span>
<span class="st">  a[[1]] &lt;- a[[1]][-delet_index]</span>
<span class="st">  song_dat$lyrics_no_singer[i] &lt;- a</span>
<span class="st">}</span>

<span class="st">engine_stop &lt;- worker(stop_word = &quot;stopword.txt&quot;)    #停用词.txt文档</span>
<span class="st">top100 &lt;- song_dat[order(-song_dat$comment),]$lyrics_no_singer[1:100]  #选择热度最高的100首歌的歌词</span>
<span class="st">seg &lt;- segment(unlist(top100),engine_stop)</span>
<span class="st"># seg &lt;- segment(top100,engine_stop)     #进行分词，并且除去停用词</span>
<span class="st">seg &lt;- seg[nchar(seg)&gt;1] #去除字符长度小于2的词语</span>

<span class="st">seg &lt;- table(seg)           #统计词频</span>
<span class="st">seg &lt;- seg[!grepl(&#39;</span>[<span class="dv">0</span><span class="op">-</span><span class="dv">9</span>]<span class="op">+</span><span class="st">&#39;,names(seg))] #去除数字</span>
<span class="st">seg &lt;- seg[!grepl(&#39;</span>[a<span class="op">-</span>z]<span class="op">+</span><span class="st">&#39;,names(seg))] #去除字母</span>
<span class="st"># length(seg)   #查看处理完后剩余的词数</span>
<span class="st">seg_100 &lt;- sort(seg, decreasing = TRUE)[1:100] #降序排序，并提取出现次数最多的前100个词语</span>
<span class="st"># seg_100           #查看100个词频最高的 </span>

<span class="st"># 绘制高频词词云</span>
<span class="st">#设置词云颜色</span>
<span class="st">mycolor &lt;- c(&#39;</span><span class="co">#69A2B0&#39;, &#39;#659157&#39;, &#39;#A1C084&#39;, &#39;#EDB999&#39;, &#39;#E05263&#39;, &quot;#ff7f50&quot;, &quot;#ff8b61&quot;, &quot;#ff9872&quot;,&quot;#ffa584&quot;, &quot;#ffb296&quot;, &quot;#ffbfa7&quot;, &quot;#ffcbb9&quot;, &quot;#ffd8ca&quot;, &quot;#ffe5dc&quot;, &quot;#fff2ed&quot;,&quot;99ffff&quot;,&quot;99cccc&quot;,&quot;66cccc&quot;,&quot;33cccc&quot;,&quot;009999&quot;,&quot;999999&quot;,&quot;ff9999&quot;,&quot;ff9933&quot;,&#39;#69A2B0&#39;, &#39;#659157&#39;, &#39;#A1C084&#39;, &#39;#EDB999&#39;, &#39;#E05263&#39;, &quot;#ff7f50&quot;, &quot;#ff8b61&quot;, &quot;#ff9872&quot;, &quot;#ffa584&quot;, &quot;#ffb296&quot;, &quot;#ffbfa7&quot;,&quot;#ffcbb9&quot;, &quot;#ffd8ca&quot;, &quot;#ffe5dc&quot;, &quot;#fff2ed&quot;,&quot;99ffff&quot;,&quot;99cccc&quot;,&quot;66cccc&quot;,&quot;33cccc&quot;,&quot;009999&quot;,&quot;999999&quot;,&quot;ffff99&quot;,&quot;ccccff&quot;,&quot;ffcc66&quot;,&quot;ffcc99&quot;,&quot;ff6666&quot;,&quot;99cc99&quot;,&#39;#69A2B0&#39;, &#39;#659157&#39;, &#39;#A1C084&#39;, &#39;#EDB999&#39;, &#39;#E05263&#39;, &quot;#ff7f50&quot;, &quot;#ff8b61&quot;, &quot;#ff9872&quot;,&quot;#ffa584&quot;, &quot;#ffb296&quot;, &quot;#ffbfa7&quot;, &quot;#fff2ed&quot;,&quot;99ffff&quot;,&quot;99cccc&quot;,&quot;66cccc&quot;,&quot;33cccc&quot;,&quot;009999&quot;,&quot;999999&quot;,&quot;ff9999&quot;,&quot;ff9933&quot;,&#39;#69A2B0&#39;, &#39;#659157&#39;, &#39;#A1C084&#39;, &#39;#EDB999&#39;, &#39;#E05263&#39;, &quot;#ff7f50&quot;, &quot;#ff8b61&quot;, &quot;#ff9872&quot;, &quot;#ffa584&quot;, &quot;#ffb296&quot;,&quot;#ff8b61&quot;, &quot;#ff9872&quot;, &quot;#ffa584&quot;, &quot;#ffb296&quot;, &quot;#ffbfa7&quot;,&#39;#69A2B0&#39;, &#39;#659157&#39;, &#39;#A1C084&#39;,&quot;#fff2ed&quot;,&quot;99ffff&quot;,&quot;99cccc&quot;,&quot;66cccc&quot;,&quot;33cccc&quot;,&quot;009999&quot;,&quot;999999&quot;,&quot;ff9999&quot;,&quot;ff9933&quot;,&#39;#69A2B0&#39;, &#39;#659157&#39;, &#39;#A1C084&#39;, &#39;#EDB999&#39;, &#39;#E05263&#39;, &quot;#ff7f50&quot;)</span>
<span class="kw">wordcloud2</span>(seg_<span class="dv">100</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">color =</span> mycolor, <span class="dt">fontFamily =</span> <span class="st">&quot;微软雅黑&quot;</span>) <span class="co">#绘制词云</span>

<span class="co"># 押韵程度和最多押韵韵脚</span>
song_dat2 &lt;-<span class="st"> </span>song_dat[<span class="kw">which</span>(song_dat<span class="op">$</span>lyrics_no_singer <span class="op">!=</span><span class="st"> &quot;&quot;</span>),]    <span class="co">#去除歌词为空值的</span>
<span class="co"># song_dat2 &lt;- song_dat2[nchar(song_dat2$lyrics_no_singer) &gt; 20,]   #选择出歌词字符数量大于20的</span>
yunmu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;e&quot;</span>,<span class="st">&quot;i&quot;</span>,<span class="st">&quot;o&quot;</span>,<span class="st">&quot;u&quot;</span>,<span class="st">&quot;v&quot;</span>)
<span class="co">#几首歌词有bug的歌曲</span>
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;0035Qwhy3M1jDE&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;003GDcQk0q8DNt&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;001wURcl1L4Mop&quot;</span>),]



<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">931</span><span class="op">:</span><span class="kw">nrow</span>(song_dat2)){
  no_na_lyrics &lt;-<span class="st"> </span>song_dat2<span class="op">$</span>lyrics_no_singer[i][[<span class="dv">1</span>]] <span class="co">#提出每首歌歌词(格式是list)</span>
  <span class="co">#一首歌每句歌词的最后一个完整拼音</span>
  last_pinyin &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> <span class="kw">length</span>(no_na_lyrics))
  lastword &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> <span class="kw">length</span>(no_na_lyrics))
  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(last_pinyin)){
    lastword[m] &lt;-<span class="st"> </span><span class="kw">substring</span>(no_na_lyrics[m], <span class="kw">str_length</span>(no_na_lyrics[m]), <span class="kw">str_length</span>(no_na_lyrics[m]))
    lastword &lt;-<span class="st"> </span>lastword[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;[0-9]+&#39;</span>,lastword)]
    lastword &lt;-<span class="st"> </span>lastword[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;[a-z]+&#39;</span>,lastword)]
    lastword &lt;-<span class="st"> </span>lastword[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;[A-Z]+&#39;</span>,lastword)]
    last_pinyin[m] &lt;-<span class="st"> </span><span class="kw">toPinyin</span>(lastword[m])
  }
  last_pinyin &lt;-<span class="st"> </span>last_pinyin[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;NA&#39;</span>,last_pinyin)]

  <span class="co">#一首歌每句歌词最后一个字的韵母</span>
  last_yunmu &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> <span class="kw">length</span>(last_pinyin))
  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(last_pinyin)){
  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">str_length</span>(last_pinyin[j])){ <span class="co">#else表示到韵母了</span>
    <span class="cf">if</span>(<span class="op">!</span><span class="kw">substring</span>(last_pinyin[j], k, k) <span class="op">%in%</span><span class="st"> </span>yunmu){
      temp &lt;-<span class="st"> </span><span class="kw">substring</span>(last_pinyin[j], k<span class="op">+</span><span class="dv">1</span>, <span class="kw">str_length</span>(last_pinyin[j]))
    } <span class="cf">else</span>  last_yunmu[j] &lt;-<span class="st"> </span>temp
  }
  }
  last_yunmu &lt;-<span class="st"> </span>last_yunmu[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;NA&#39;</span>,last_yunmu)]
song_dat2<span class="op">$</span>yayun_scale[i] &lt;-<span class="st"> </span><span class="kw">table</span>(last_yunmu) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">max</span>()
song_dat2<span class="op">$</span>yunjiao[i] &lt;-<span class="st"> </span><span class="kw">rownames</span>(<span class="kw">table</span>(last_yunmu))[<span class="kw">which.max</span>(<span class="kw">table</span>(last_yunmu))]
}

yunjiao_table &lt;-<span class="st"> </span><span class="kw">table</span>(song_dat2<span class="op">$</span>yunjiao)
yunjiao_frame &lt;-<span class="st"> </span><span class="kw">sort</span>(yunjiao_table, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() <span class="co">#热门韵脚</span>

<span class="kw">ggplot</span>(yunjiao_frame, <span class="kw">aes</span>(<span class="dt">x =</span> Var1, <span class="dt">y =</span> Freq)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;韵脚&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;频数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()


<span class="kw">ggplot</span>(song_dat2, <span class="kw">aes</span>(<span class="dt">x =</span> yayun_scale, <span class="dt">y =</span> comment<span class="op">/</span><span class="dv">10000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">24</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">15</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;押韵程度&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;评论数/万&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()


yunjiao_box &lt;-<span class="st"> </span>song_dat2[<span class="kw">which</span>(song_dat2<span class="op">$</span>yunjiao <span class="op">%in%</span><span class="st"> </span>yunjiao_frame<span class="op">$</span>Var1),]
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(yunjiao_box)) {
  yunjiao_box<span class="op">$</span>median_yunjiao[i] &lt;-<span class="st"> </span><span class="kw">median</span>(yunjiao_box<span class="op">$</span>comment[<span class="kw">which</span>(yunjiao_box<span class="op">$</span>yunjiao <span class="op">==</span><span class="st"> </span>yunjiao_box<span class="op">$</span>yunjiao[i])])
}

<span class="kw">ggplot</span>(yunjiao_box,<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(yunjiao, median_yunjiao), <span class="dt">y =</span> <span class="kw">log</span>(comment))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">varwidth=</span><span class="ot">TRUE</span>,<span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;chocolate4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;韵脚&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;对数评论数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 句子长度，重复数量，句子数量</span>
<span class="co"># 有bug的歌曲</span>
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;002aEfK42ZJne3&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;002nEJxP4SzmVr&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;000gyfCe3og7HL&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;000M3yim4cbxkc&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;003wCfWs3RT5pc&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;002SAzyy1aY8jK&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;000qoKip1AYapG&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;003W3mdN1hncrS&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;000mE2ff3uKO6L&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;001mCAni3WN043&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;002axyOV0Lvpbb&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;001Oaacc48zoBn&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;004eqh310KvtLZ&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;0045J9sT2tCkCV&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;000ppUwW1sb2lS&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;001H5tpN3WRmZd&quot;</span>),]
song_dat2 &lt;-<span class="st"> </span>song_dat2[<span class="op">-</span><span class="kw">which</span>(song_dat2<span class="op">$</span>song_id <span class="op">==</span><span class="st"> &quot;002ASPoZ3cVea3&quot;</span>),]



<span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(song_dat2)){
  count_sentence &lt;-<span class="st"> </span><span class="dv">0</span>
  <span class="co"># b &lt;- onlysong_no_outlier$lyrics_no_singer[j] #取出每一行的歌词</span>
  <span class="co"># b &lt;- gsub(pattern=&quot;\r\n\r\n&quot;, replacement=&quot; &quot;, b,fixed=T) %&gt;%</span>
  <span class="co">#   gsub(pattern=&quot;\r\n&quot;, replacement=&quot; &quot;, b,fixed=T) %&gt;%</span>
  <span class="co">#   gsub(pattern=&quot;\t&quot;, replacement=&quot;&quot;, b,fixed=T) #去掉所有的空格换行</span>
  <span class="co"># no_na_lyrics &lt;- strsplit(b, &#39; &#39;)[[1]][-which(strsplit(b, &#39; &#39;)[[1]] == &quot;&quot;)]</span>
  no_na_lyrics &lt;-<span class="st"> </span>song_dat2<span class="op">$</span>lyrics_no_singer[j][[<span class="dv">1</span>]] <span class="co">#提出每首歌歌词(格式是list)</span>
  no_na_lyrics &lt;-<span class="st"> </span>no_na_lyrics[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;[a-z]+&#39;</span>,no_na_lyrics)] <span class="co">#去除字母</span>
  song_dat2<span class="op">$</span>sentence_num[j] &lt;-<span class="st"> </span><span class="kw">length</span>(no_na_lyrics) <span class="co">#句子数量</span>
  song_dat2<span class="op">$</span>sentence_length[j] &lt;-<span class="st"> </span><span class="kw">str_length</span>(no_na_lyrics) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>()<span class="co">#每首歌平均句长</span>
  
  <span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(no_na_lyrics)<span class="op">-</span><span class="dv">1</span>))){
    <span class="cf">if</span> (no_na_lyrics[i] <span class="op">==</span><span class="st"> </span>no_na_lyrics[i<span class="op">+</span><span class="dv">1</span>]){
      count_sentence &lt;-<span class="st"> </span>count_sentence <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    }
  }
  song_dat2<span class="op">$</span>repeat_lyrics[j] &lt;-<span class="st"> </span>count_sentence
}


<span class="co"># 句子数量（篇幅）</span>
<span class="kw">ggplot</span>(song_dat2, <span class="kw">aes</span>(<span class="dt">x =</span> sentence_num, <span class="dt">y =</span> comment)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;句子数量&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;评论数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">25</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">55</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 平均句长</span>
<span class="kw">ggplot</span>(song_dat2, <span class="kw">aes</span>(<span class="dt">x =</span> sentence_length, <span class="dt">y =</span> comment)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;平均句子长度/字&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;评论数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">6</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">9</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 重复手法</span>
<span class="kw">ggplot</span>(song_dat2,<span class="kw">aes</span>(<span class="dt">x =</span> repeat_lyrics, <span class="dt">y =</span> comment)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="co">#geom_bar(stat = &quot;identity&quot;,fill = &quot;orange2&quot;, width = 1) +</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;歌词重复数&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;评论数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 工整句式</span>
<span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(song_dat2)){
  <span class="co"># count_sentence &lt;- 0</span>
  b &lt;-<span class="st"> </span>onlysong_no_outlier<span class="op">$</span>lyrics_no_singer[j] <span class="co">#取出每一行的歌词</span>
  b &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="st">&quot;</span><span class="ch">\r\n\r\n</span><span class="st">&quot;</span>, <span class="dt">replacement=</span><span class="st">&quot; &quot;</span>, b,<span class="dt">fixed=</span>T) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="st">&quot;</span><span class="ch">\r\n</span><span class="st">&quot;</span>, <span class="dt">replacement=</span><span class="st">&quot; &quot;</span>, b,<span class="dt">fixed=</span>T) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">replacement=</span><span class="st">&quot;&quot;</span>, b,<span class="dt">fixed=</span>T) <span class="co">#去掉所有的空格换行</span>
  no_na_lyrics &lt;-<span class="st"> </span><span class="kw">strsplit</span>(b, <span class="st">&#39; &#39;</span>)[[<span class="dv">1</span>]][<span class="op">-</span><span class="kw">which</span>(<span class="kw">strsplit</span>(b, <span class="st">&#39; &#39;</span>)[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> &quot;&quot;</span>)]  <span class="co">#分成一句一句的</span>
  no_na_lyrics &lt;-<span class="st"> </span>no_na_lyrics[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;[a-z]+&#39;</span>,no_na_lyrics)] <span class="co">#去除字母</span>
  
  <span class="co"># onlysong_no_outlier$sentence_num[j] &lt;- length(no_na_lyrics) #句子数量</span>
  <span class="co"># onlysong_no_outlier$sentence_length[j] &lt;- str_length(no_na_lyrics) %&gt;% mean()#每首歌平均句长</span>
  onlysong_no_outlier<span class="op">$</span>sentence_tidy[j] &lt;-<span class="st"> </span><span class="kw">str_length</span>(no_na_lyrics) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">table</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">max</span>() <span class="co">#句子长度一样的最多数量</span>
}

<span class="kw">ggplot</span>(onlysong_no_outlier, <span class="kw">aes</span>(<span class="dt">x =</span> sentence_tidy, <span class="dt">y =</span> comment)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;orange2&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;句子工整程度&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;评论数&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">10</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">17</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 词向量 + 聚类</span>
<span class="co"># 把分好的词写进.txt文档</span>
<span class="kw">write.table</span>(seg, <span class="st">&quot;lyrics.txt&quot;</span>)

<span class="kw">library</span>(tmcn) <span class="co"># 加载训练词向量程序包</span>
<span class="co"># 自编译word2vec函数(参考链接：https://gist.github.com/badbye/a41db116e6f3490d0505aba704661050)</span>
word2vec &lt;-<span class="st"> </span><span class="cf">function</span> (train_file, output_file, 
                      <span class="dt">binary=</span><span class="dv">1</span>,                         <span class="co"># output format, 1-binary, 0-txt</span>
                      <span class="dt">cbow=</span><span class="dv">0</span>,                           <span class="co"># skip-gram (0) or continuous bag of words (1) </span>
                      <span class="dt">num_threads =</span> <span class="dv">1</span>,                  <span class="co"># num of workers </span>
                      <span class="dt">num_features =</span> <span class="dv">300</span>,               <span class="co"># word vector dimensionality </span>
                      <span class="dt">window =</span> <span class="dv">10</span>,                      <span class="co"># context / window size </span>
                      <span class="dt">min_count =</span> <span class="dv">40</span>,                   <span class="co"># minimum word count </span>
                      <span class="dt">sample =</span> <span class="fl">1e-3</span>,                    <span class="co"># downsampling of frequent words</span>
                      <span class="dt">classes =</span> <span class="dv">0</span>
){
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(train_file)) 
        <span class="kw">stop</span>(<span class="st">&quot;Can&#39;t find the trsin file!&quot;</span>)
    train_dir &lt;-<span class="st"> </span><span class="kw">dirname</span>(train_file)
    <span class="cf">if</span> (<span class="kw">missing</span>(output_file)) {
        output_file &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="kw">gsub</span>(<span class="st">&quot;^.*</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">basename</span>(train_file)), 
            <span class="st">&quot;bin&quot;</span>, <span class="kw">basename</span>(train_file))
        output_file &lt;-<span class="st"> </span><span class="kw">file.path</span>(train_dir, output_file)
    }
    outfile_dir &lt;-<span class="st"> </span><span class="kw">dirname</span>(output_file)
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(outfile_dir)) 
        <span class="kw">dir.create</span>(outfile_dir, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)
    train_file &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(train_file, <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>, <span class="dt">mustWork =</span> <span class="ot">FALSE</span>)
    output_file &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(output_file, <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>, 
        <span class="dt">mustWork =</span> <span class="ot">FALSE</span>)
    OUT &lt;-<span class="st"> </span><span class="kw">.C</span>(<span class="st">&quot;CWrapper_word2vec&quot;</span>, <span class="dt">train_file =</span> <span class="kw">as.character</span>(train_file), 
        <span class="dt">output_file =</span> <span class="kw">as.character</span>(output_file), <span class="dt">binary =</span> <span class="kw">as.character</span>(binary),
        <span class="dt">num_threads=</span><span class="kw">as.character</span>(num_threads), <span class="dt">num_features=</span><span class="kw">as.character</span>(num_features),
        <span class="dt">window =</span> <span class="kw">as.character</span>(window), <span class="dt">min_count=</span><span class="kw">as.character</span>(min_count),
        <span class="dt">sample=</span>sample,<span class="dt">classes=</span><span class="kw">as.character</span>(classes)
        )
    <span class="kw">class</span>(OUT) &lt;-<span class="st"> &quot;word2vec&quot;</span>
    <span class="kw">names</span>(OUT)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;model_file&quot;</span>
    <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;The model was generated in &#39;&quot;</span>, <span class="kw">dirname</span>(output_file), 
        <span class="st">&quot;&#39;!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))
    <span class="kw">return</span>(OUT)
}

<span class="kw">word2vec</span>(<span class="st">&quot;lyrics.txt&quot;</span>, <span class="st">&quot;vector.txt&quot;</span>)  <span class="co"># 将分好的词转换为词向量，储存文件在本地</span>
vector_word &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;vector.txt&quot;</span>)  <span class="co"># 读入训练好的词向量</span>

seg_<span class="dv">50</span> &lt;-<span class="st"> </span><span class="kw">sort</span>(seg, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>] <span class="co"># 提取出现次数最多的前50个词语，用来做聚类分析</span>

vec_top_<span class="dv">100</span> &lt;-<span class="st"> </span>vector_word[<span class="kw">which</span>(vector_word<span class="op">$</span>V1 <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(seg_<span class="dv">50</span>)),]  <span class="co"># 选出向量里对应的最热门的50词</span>
vec_top_100_<span class="dv">1</span> &lt;-<span class="st"> </span>vec_top_<span class="dv">100</span>[,<span class="op">-</span><span class="dv">1</span>]   <span class="co"># 去掉标题（也许吧）</span>
vec_cluster_top &lt;-<span class="st"> </span><span class="kw">scale</span>(vec_top_100_<span class="dv">1</span>)  <span class="co"># 标准化</span>

<span class="kw">library</span>(factoextra)  <span class="co"># 加载需要的程序包</span>
<span class="co">#设置随机数种子</span>
<span class="kw">set.seed</span>(<span class="dv">1000</span>)  
<span class="co">#确定最佳聚类个数，使用组内平方误差和法  </span>
<span class="kw">fviz_nbclust</span>(vec_cluster_top, kmeans, <span class="dt">method=</span><span class="st">&quot;wss&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">4</span>,<span class="dt">linetype=</span><span class="dv">2</span>) 

<span class="co">#根据最佳聚类个数，进行kmeans聚类</span>
res_top &lt;-<span class="st"> </span><span class="kw">kmeans</span>(vec_cluster_top,<span class="dv">4</span>)
<span class="co">#将分类结果放入原数据集中</span>
recombine_vec_top &lt;-<span class="st"> </span><span class="kw">cbind</span>(vec_top_<span class="dv">100</span>,res_top<span class="op">$</span>cluster)
<span class="co">#查看最终聚类图形</span>
<span class="kw">fviz_cluster</span>(res_top, <span class="dt">data =</span> vec_top_100_<span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;类别&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;类别&quot;</span>, <span class="dt">shape =</span><span class="st">&quot;类别&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()
<span class="co"># 分别储存四类词语</span>
cluster_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">as.character</span>(recombine_vec_top[<span class="kw">which</span>(recombine_vec_top<span class="op">$</span><span class="st">`</span><span class="dt">res_top$cluster</span><span class="st">`</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),<span class="st">&quot;V1&quot;</span>])
cluster_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">as.character</span>(recombine_vec_top[<span class="kw">which</span>(recombine_vec_top<span class="op">$</span><span class="st">`</span><span class="dt">res_top$cluster</span><span class="st">`</span> <span class="op">==</span><span class="st"> </span><span class="dv">2</span>),<span class="st">&quot;V1&quot;</span>])
cluster_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">as.character</span>(recombine_vec_top[<span class="kw">which</span>(recombine_vec_top<span class="op">$</span><span class="st">`</span><span class="dt">res_top$cluster</span><span class="st">`</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span>),<span class="st">&quot;V1&quot;</span>])
cluster_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">as.character</span>(recombine_vec_top[<span class="kw">which</span>(recombine_vec_top<span class="op">$</span><span class="st">`</span><span class="dt">res_top$cluster</span><span class="st">`</span> <span class="op">==</span><span class="st"> </span><span class="dv">4</span>),<span class="st">&quot;V1&quot;</span>])

<span class="co"># 词性分析</span>
<span class="co"># top100热门歌词性（101:N歌词同理）</span>
engine_stop &lt;-<span class="st"> </span><span class="kw">worker</span>(<span class="dt">type =</span> <span class="st">&quot;tag&quot;</span>,<span class="dt">stop_word =</span> <span class="st">&quot;D:/data/stopword.txt&quot;</span>)<span class="co"># 重新设置type，结果输出席次词性</span>
seg_manual_stop_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">segment</span>(seg_<span class="dv">100</span>,engine_stop)  <span class="co"># 分词</span>
seg_manual_stop_<span class="dv">100</span> &lt;-<span class="st"> </span>seg_manual_stop_<span class="dv">100</span>[<span class="kw">nchar</span>(seg_manual_stop_<span class="dv">100</span>)<span class="op">&gt;</span><span class="dv">1</span>] <span class="co"># 去掉长度小于2的词语</span>
word_type_top &lt;-<span class="st"> </span>seg_manual_stop_<span class="dv">100</span> <span class="co"># 备份</span>
<span class="co"># seg_manual_stop_100 &lt;- word_type_top # 取备份</span>
qseg_top_frame &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(seg_manual_stop_<span class="dv">100</span>)   <span class="co"># 转换成矩阵储存</span>
word_type_top_frame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">word =</span> qseg_top_frame[,<span class="dv">1</span>], <span class="dt">type =</span> <span class="kw">rownames</span>(qseg_top_frame))  <span class="co"># 转换成数据框</span>
word_type_top_frame<span class="op">$</span>word &lt;-<span class="st"> </span><span class="kw">as.character</span>(word_type_top_frame<span class="op">$</span>word)  <span class="co"># 数据形式转换</span>
word_type_top_frame<span class="op">$</span>type &lt;-<span class="st"> </span><span class="kw">as.character</span>(word_type_top_frame<span class="op">$</span>type)  <span class="co"># 数据形式转化</span>

<span class="kw">table</span>(word_type_top_frame<span class="op">$</span>type)  <span class="co"># 统计不同词性的比例</span>
word_type_top_frame &lt;-<span class="st"> </span>word_type_top_frame[<span class="kw">c</span>(<span class="op">-</span><span class="st"> </span><span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &#39;eng&#39;</span>)),] <span class="co"># 删除英文词</span>
<span class="co"># 根据词性对应表，把英文改成中文（写得很麻烦，需要简化），参考：</span>

<span class="co"># split_year_flag &lt;- function(x){  #设置发行年份flag函数</span>
<span class="co">#   if ((x &gt; 1976) &amp; (x &lt; 1990)) return(&#39;1990年以前&#39;)</span>
<span class="co">#   if (x &lt; 1995)                return(&#39;1990-1995年&#39;)</span>
<span class="co">#   if (x &lt; 2000)                return(&#39;1995-2000年&#39;)</span>
<span class="co">#   if (x &lt; 2005)                return(&#39;2000-2005年&#39;)</span>
<span class="co">#   if (x &lt; 2010)                return(&#39;2005-2010年&#39;)</span>
<span class="co">#   if (x &lt; 2015)                return(&#39;2010-2015年&#39;)</span>
<span class="co">#   return(&#39;2015-2018年&#39;)</span>
<span class="co"># }</span>

word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;a&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;形容词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;ad&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;副形词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;an&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;名形词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;b&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;区别词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;c&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;连词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;d&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;副词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;e&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;叹词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;f&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;方位词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;i&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;成语&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;j&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;简称略语&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;l&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;习用语&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;m&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;数词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;mq&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;数量词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;n&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;名词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;nr&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;人名&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;nrfg&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;未知&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;nrt&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;未知&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;ns&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;地名&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;nt&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;机构团体&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;nz&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;其他专名&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;o&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;拟声词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;p&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;介词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;q&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;量词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;r&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;代词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;s&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;处所词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;t&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;时间词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;v&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;动词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;vn&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;名动词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;vq&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;未知&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;x&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;非语素字&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;y&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;语气词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;z&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;状态词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;rr&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;人称代词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;rz&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;指示代词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;u&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;助词&quot;</span>
word_type_top_frame[<span class="kw">which</span>(word_type_top_frame<span class="op">$</span>type <span class="op">==</span><span class="st"> &quot;vd&quot;</span>),<span class="st">&quot;chi_type&quot;</span>] &lt;-<span class="st"> &quot;副动词&quot;</span>

word_type_top_frame &lt;-<span class="st"> </span><span class="kw">table</span>(word_type_top_frame<span class="op">$</span>chi_type) <span class="co"># 统计不同词性的频数</span>
word_type_top_<span class="dv">10</span> &lt;-<span class="st"> </span><span class="kw">sort</span>(word_type_top_frame, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]  <span class="co"># 最热门的10种词性</span>
top_10_type_top &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(word_type_top_<span class="dv">10</span>)  <span class="co"># 把table转换成数据框</span>
top_10_type_top<span class="op">$</span>Var1 &lt;-<span class="st"> </span><span class="kw">as.character</span>(top_10_type_top<span class="op">$</span>Var1)  <span class="co"># 改变数据形式</span>
top_10_type_top &lt;-<span class="st"> </span>top_10_type_top[<span class="kw">c</span>( <span class="op">-</span><span class="kw">which</span>(top_10_type_top<span class="op">$</span>Var1 <span class="op">==</span><span class="st"> &#39;非语素字&#39;</span>)),]  <span class="co"># 删除一种少见的词性</span>

top_10_type_top<span class="op">$</span>por &lt;-<span class="st"> </span>top_10_type_top<span class="op">$</span>Freq <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(top_10_type_top<span class="op">$</span>Freq)  <span class="co"># 统计各词性所占比例</span>
<span class="co"># 绘制词性偏好条形图</span>
top_word_type &lt;-<span class="st"> </span>top_10_type_top
<span class="kw">ggplot</span>(top_word_type,<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(Var1,<span class="op">-</span>por), <span class="dt">y =</span> por)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;orange2&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;词性&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;占比&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>()

<span class="co"># 对比top100和101:N的各词性比例</span>
<span class="kw">library</span>(reshape2)  <span class="co"># 数据框整形程序包</span>
total_word_type &lt;-<span class="st"> </span><span class="kw">merge</span>(top_word_type, bottom_word_type, <span class="st">&quot;Var1&quot;</span>)  <span class="co"># 合并两个数据框</span>
total_word_type &lt;-<span class="st"> </span>total_word_type[,<span class="kw">c</span>(<span class="st">&quot;Var1&quot;</span>,<span class="st">&quot;por.x&quot;</span>,<span class="st">&quot;por.y&quot;</span>)]  <span class="co"># 取出不重复的列</span>
total_word_type_melt &lt;-<span class="st"> </span><span class="kw">melt</span>(total_word_type, <span class="dt">var.id =</span> <span class="st">&quot;Var1&quot;</span>)  <span class="co"># 变成长数据框</span>
<span class="co"># 绘制两种情况的词性占比条形图（对比图）</span>
<span class="kw">ggplot</span>(total_word_type_melt,<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(Var1,<span class="op">-</span>value), <span class="dt">y =</span> value, <span class="dt">fill =</span> variable)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;词性&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;占比&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;歌曲类别&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">my_ggtheme</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;TOP100&quot;</span>,<span class="st">&quot;其他&quot;</span>), <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&#39;orange2&#39;</span>, <span class="st">&#39;chocolate4&#39;</span>))</code></pre></div>


</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="binomial.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sound.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-chinese/edit/master/09-final-task.Rmd",
"text": "缂栬緫"
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
