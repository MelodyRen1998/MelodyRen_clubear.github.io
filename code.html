<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>狗熊会人才计划第三期——My Case</title>
  <meta name="description" content="人才计划TASK &amp; Final Project。">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="狗熊会人才计划第三期——My Case" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="人才计划TASK &amp; Final Project。" />
  <meta name="github-repo" content="yihui/bookdown-chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="狗熊会人才计划第三期——My Case" />
  
  <meta name="twitter:description" content="人才计划TASK &amp; Final Project。" />
  

<meta name="author" content="yimeng">


<meta name="date" content="2018-09-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data.html">
<link rel="next" href="descriptive.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">狗熊会人才计划第三期</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#e887b4e8b0a2"><i class="fa fa-check"></i>致谢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> 狗熊会人才计划介绍</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#whats-that"><i class="fa fa-check"></i><b>1.1</b> 狗熊会，what’s that?!</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#omd"><i class="fa fa-check"></i><b>1.2</b> 人才计划，OMD!</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 人才计划导师天团</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="wind.html"><a href="wind.html"><i class="fa fa-check"></i><b>2</b> 人才计划章程</a><ul>
<li class="chapter" data-level="2.1" data-path="wind.html"><a href="wind.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 纪律</a><ul>
<li class="chapter" data-level="2.1.1" data-path="wind.html"><a href="wind.html#ddl"><i class="fa fa-check"></i><b>2.1.1</b> DDL</a></li>
<li class="chapter" data-level="2.1.2" data-path="wind.html"><a href="wind.html#section-2.1.2"><i class="fa fa-check"></i><b>2.1.2</b> 礼貌</a></li>
<li class="chapter" data-level="2.1.3" data-path="wind.html"><a href="wind.html#section-2.1.3"><i class="fa fa-check"></i><b>2.1.3</b> 作业</a></li>
<li class="chapter" data-level="2.1.4" data-path="wind.html"><a href="wind.html#section-2.1.4"><i class="fa fa-check"></i><b>2.1.4</b> 退出</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="wind.html"><a href="wind.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 禁止抄袭</a></li>
<li class="chapter" data-level="2.3" data-path="wind.html"><a href="wind.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 作业质量</a></li>
<li class="chapter" data-level="2.4" data-path="wind.html"><a href="wind.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 自学</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>3</b> TASK 1 背景介绍</a><ul>
<li class="chapter" data-level="3.1" data-path="background.html"><a href="background.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 学习资料</a></li>
<li class="chapter" data-level="3.2" data-path="background.html"><a href="background.html#good-work"><i class="fa fa-check"></i><b>3.2</b> Good Work</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> TASK 2 数据说明</a><ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>4.1</b> 学习资料</a></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 数据概览</a></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#good-work-1"><i class="fa fa-check"></i><b>4.3</b> Good Work</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>5</b> TASK 3 代码规范</a><ul>
<li class="chapter" data-level="5.1" data-path="code.html"><a href="code.html#-2"><i class="fa fa-check"></i><b>5.1</b> 学习资料</a><ul>
<li class="chapter" data-level="5.1.1" data-path="code.html"><a href="code.html#section-5.1.1"><i class="fa fa-check"></i><b>5.1.1</b> 注释篇</a></li>
<li class="chapter" data-level="5.1.2" data-path="code.html"><a href="code.html#section-5.1.2"><i class="fa fa-check"></i><b>5.1.2</b> 命名篇</a></li>
<li class="chapter" data-level="5.1.3" data-path="code.html"><a href="code.html#section-5.1.3"><i class="fa fa-check"></i><b>5.1.3</b> 函数模块化</a></li>
<li class="chapter" data-level="5.1.4" data-path="code.html"><a href="code.html#section-5.1.4"><i class="fa fa-check"></i><b>5.1.4</b> 纠错与调试</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="code.html"><a href="code.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 共享单车案例</a><ul>
<li class="chapter" data-level="5.2.1" data-path="code.html"><a href="code.html#section-5.2.1"><i class="fa fa-check"></i><b>5.2.1</b> 准备工作</a></li>
<li class="chapter" data-level="5.2.2" data-path="code.html"><a href="code.html#-"><i class="fa fa-check"></i><b>5.2.2</b> 分析报告 &amp; 代码</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="descriptive.html"><a href="descriptive.html"><i class="fa fa-check"></i><b>6</b> TASK 4 描述分析</a><ul>
<li class="chapter" data-level="6.1" data-path="descriptive.html"><a href="descriptive.html#-3"><i class="fa fa-check"></i><b>6.1</b> 学习资料</a></li>
<li class="chapter" data-level="6.2" data-path="descriptive.html"><a href="descriptive.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 题目</a></li>
<li class="chapter" data-level="6.3" data-path="descriptive.html"><a href="descriptive.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 探究影响消费金融贷款申请人数的因素——描述性分析</a><ul>
<li class="chapter" data-level="6.3.1" data-path="descriptive.html"><a href="descriptive.html#section-6.3.1"><i class="fa fa-check"></i><b>6.3.1</b> 对申请人数（因变量）进行描述</a></li>
<li class="chapter" data-level="6.3.2" data-path="descriptive.html"><a href="descriptive.html#section-6.3.2"><i class="fa fa-check"></i><b>6.3.2</b> 对借贷变量（自变量）进行描述</a></li>
<li class="chapter" data-level="6.3.3" data-path="descriptive.html"><a href="descriptive.html#section-6.3.3"><i class="fa fa-check"></i><b>6.3.3</b> 对还贷变量（自变量）进行描述</a></li>
<li class="chapter" data-level="6.3.4" data-path="descriptive.html"><a href="descriptive.html#section-6.3.4"><i class="fa fa-check"></i><b>6.3.4</b> 初步结论</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="descriptive.html"><a href="descriptive.html#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 代码</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="linear-model.html"><a href="linear-model.html"><i class="fa fa-check"></i><b>7</b> TASK 5 线性回归分析</a><ul>
<li class="chapter" data-level="7.1" data-path="linear-model.html"><a href="linear-model.html#-4"><i class="fa fa-check"></i><b>7.1</b> 学习资料</a></li>
<li class="chapter" data-level="7.2" data-path="linear-model.html"><a href="linear-model.html#section-7.2"><i class="fa fa-check"></i><b>7.2</b> 短租房热度案例</a><ul>
<li class="chapter" data-level="7.2.1" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>7.2.1</b> 准备工作</a></li>
<li class="chapter" data-level="7.2.2" data-path="linear-model.html"><a href="linear-model.html#--1"><i class="fa fa-check"></i><b>7.2.2</b> 分析报告 &amp; 代码</a></li>
<li class="chapter" data-level="7.2.3" data-path="linear-model.html"><a href="linear-model.html#section-7.2.3"><i class="fa fa-check"></i><b>7.2.3</b> 标准答案代码</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="binomial.html"><a href="binomial.html"><i class="fa fa-check"></i><b>8</b> TASK 6 分类问题</a><ul>
<li class="chapter" data-level="8.1" data-path="binomial.html"><a href="binomial.html#-5"><i class="fa fa-check"></i><b>8.1</b> 学习资料</a><ul>
<li class="chapter" data-level="8.1.1" data-path="binomial.html"><a href="binomial.html#section-8.1.1"><i class="fa fa-check"></i><b>8.1.1</b> 逻辑回归模型</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>8.2</b> 题目</a></li>
<li class="chapter" data-level="8.3" data-path="binomial.html"><a href="binomial.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> 影响消费贷款有效性的因素分析</a><ul>
<li class="chapter" data-level="8.3.1" data-path="binomial.html"><a href="binomial.html#section-8.3.1"><i class="fa fa-check"></i><b>8.3.1</b> 背景与研究问题</a></li>
<li class="chapter" data-level="8.3.2" data-path="binomial.html"><a href="binomial.html#section-8.3.2"><i class="fa fa-check"></i><b>8.3.2</b> 描述性分析</a></li>
<li class="chapter" data-level="8.3.3" data-path="binomial.html"><a href="binomial.html#section-8.3.3"><i class="fa fa-check"></i><b>8.3.3</b> 模型建立与选择</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data.html"><a href="data.html#-1"><i class="fa fa-check"></i><b>8.4</b> 代码</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="final.html"><a href="final.html"><i class="fa fa-check"></i><b>9</b> Fianl Project</a><ul>
<li class="chapter" data-level="9.1" data-path="final.html"><a href="final.html#slides"><i class="fa fa-check"></i><b>9.1</b> 作品Slides</a></li>
<li class="chapter" data-level="9.2" data-path="code.html"><a href="code.html#-2"><i class="fa fa-check"></i><b>9.2</b> 代码</a></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="sound.html"><a href="sound.html"><i class="fa fa-check"></i><b>A</b> 附录</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">狗熊会人才计划第三期——My Case</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="code" class="section level1">
<h1><span class="header-section-number">第 5 章</span> TASK 3 代码规范</h1>
<div id="-2" class="section level2">
<h2><span class="header-section-number">5.1</span> 学习资料</h2>
<div id="section-5.1.1" class="section level3">
<h3><span class="header-section-number">5.1.1</span> 注释篇</h3>
<ul>
<li><p>文件注释：写清楚这个代码文件主要是用来做什么的。</p></li>
<li><p>分块注释：写清楚这部分代码的主要功能。例如：这部分代码是数据描述的，那部分代码是建模的。</p></li>
<li><p>重要的代码注释：写清楚这句代码的主要用途，如何思考的，涉及到的重要公式有时候都可能需要。记住对于每据的代码尽量对齐。</p></li>
</ul>
<div align="center">
<p><img src="code-rule.JPG" width=80% height=80% alt="code-rule"/></p>
</div>
</div>
<div id="section-5.1.2" class="section level3">
<h3><span class="header-section-number">5.1.2</span> 命名篇</h3>
<ul>
<li><p>用有意义的词定义变量名。例如车联网的案例中，我们会定义某辆车在某段行程中的最大速度。那么就可以使用speed-max来定义这个变量。千万不要使用zuidasudu。</p></li>
<li><p>构建自己一致的代码风格。我们命名规则分为：文件名，变量名，函数名，常数名。例如：文件命名predict.adrevenueR（一看就知道是广告收入预测）；变量及函数命名规则：在R环境下，大小写是敏感的。变量名小写字母，单词间用一分隔；函数名用每个单词用大写字母开头，不用一连接。常数项跟函数一样命名但以小k开头。</p></li>
<li><p>变量：avg-clicks</p></li>
<li><p>函数名CalculateAvgClicks（函数是个动作，所以可以一般写成动宾结构）</p></li>
<li><p>常数项：kConstantName</p></li>
</ul>
<p>这样就构建了你自己的代码风格。保持一致，并告诉合作者，大家都能明白了。</p>
<ul>
<li><p>全球统一的代码风格。如果不能形成自己的代码风格，或者觉得不知道怎么形成。那么使用别人规定好的代码风格就好了。</p></li>
<li><p><a href="https://google.github.io/styleguide/Rguide.xml">Google-Style</a></p></li>
<li><p><a href="http://adv-r.had.co.nz/Style.html">Hadley-Style</a></p></li>
</ul>
</div>
<div id="section-5.1.3" class="section level3">
<h3><span class="header-section-number">5.1.3</span> 函数模块化</h3>
<p>代码写得好不好，全靠函数来提高。这什么情况呢？我们继续以车联网的案例为例子。在对车联网数据做数据描述的时候，我们经常希望能够画出某辆车在重要的行程上的轨迹。这里面就会涉及到，如何画从某个启示点到终点的轨迹的代码。设想你画了三个轨迹之后，必然发现代码十分冗余，每次都写同样的画图部分，如果用ggplot2，更是一堆参数设置，不停的复制黏贴。那么为什么我们不把重复出现的代码模块化到同一个函数呢？命名为：PlotCarTrip。</p>
</div>
<div id="section-5.1.4" class="section level3">
<h3><span class="header-section-number">5.1.4</span> 纠错与调试</h3>
<p>纠错应该是写好代码最重要的一个环节。我曾经问过写代码的人，你怎么纠错呀。很多人回答是我不纠错！吓死宝宝了，那代码真没问题吗？</p>
<p>俗话说的好：谁写的代码没有错。知错能改，善莫大焉。那么怎么改！大家尝试下如下按钮。</p>
<div align="center">
<p><img src="debug-1.JPG" width=80% height=80% alt="debug-1"/></p>
</div>
<p>千万不要掉以轻心，还有两大难关需要过。分别是：<strong>提高代码效率与提高代码可读性</strong>。</p>
<p>首先，如何检查代码效率呢。代码效率就是要知道，我写了这么多代码，哪部分运行起来最耗时呢？同样的工作，我跑了24小时，累死机器宝宝了。别人1小时跑完，还出去吃喝玩乐了一把，好羡慕呀。那么这问题咋解决。你必须找到你的代码不行的地方。怎么找？可以试试如下按钮哦。</p>
<div align="center">
<p><img src="debug-2.JPG" width=80% height=80% alt="debug-2"/></p>
</div>
<p>其次，如何解决那些效率低下的代码呢。常见的方法如下：</p>
<ul>
<li>向量化处理</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 构建一个10*10的矩阵，矩阵的第一列都是1，第二列都是2，一直到第十列都是10</span>

<span class="co"># 方法一</span>
m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">ncol =</span> <span class="dv">10</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){
  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){
    m[i,j] &lt;-<span class="st"> </span>j
  }
}

<span class="co"># 方法二：利用了向量化赋值</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){
  m[,i] &lt;-<span class="st"> </span>i
}

<span class="co"># 方法三：线性代数的乘法运算</span>
m &lt;-<span class="st"> </span>m <span class="op">%*%</span><span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</code></pre></div>
<ul>
<li>使用内置函数</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 求矩阵m的列均值</span>

avg1 &lt;-<span class="st"> </span><span class="kw">c</span>()
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){
  avg1[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(m[,i])
}

avg2 &lt;-<span class="st"> </span><span class="kw">apply</span>(m, <span class="dv">2</span>, mean)

avg3 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(m)</code></pre></div>
</div>
</div>
<div id="section-5.2" class="section level2">
<h2><span class="header-section-number">5.2</span> 共享单车案例</h2>
<blockquote>
<p>案例难度：**</p>
</blockquote>
<div id="section-5.2.1" class="section level3">
<h3><span class="header-section-number">5.2.1</span> 准备工作</h3>
<p>案例背景：共享单车轨迹数据，记录了共享单车在何时处于何位置。通过分析共享单车数据，可以为共享单车调度和研究城市交通带来一定的价值。</p>
<p>案例数据提供了某共享单车系统的站点数据（station）和行程数据（trip）。站点数据告诉我们哪里有什么站点，行程数据告诉我们在何时何地、何人借了何车，又在何时何地还车。为了更好的理解数据，需要了解站点规模和用户类型两个概念。站点规模，即该站点的车桩数。出于经济方面的考虑，规模小的公共自行车系统（O’Brien, O., et al., 2013, p. 3）往往会用规模小的自行车站点。规模大的站点有利于满足公众的骑行需求，应对短时间内的大流量交易；而规模较小的站点适用于鲜有流量大幅激增的区域，降低投资和运营成本，节省公共用地。用户类别分两种，游客和居民。区别是游客的使用是临时的，居民的使用是定期的。详细数据字典可以参加推文公共自行车损坏识别。</p>
<p>这个案例的<strong>学习目标</strong>包括：</p>
<ul>
<li><p>了解共享单车轨迹数据；</p></li>
<li><p>理解轨迹数据的基本角度，学会对贡献单车数据做基本的描述性分析，并且适当解读。</p></li>
<li><p>了解基本的可视化方法。</p></li>
</ul>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">5.2.2</span> 分析报告 &amp; 代码</h3>
<p><strong>环境设置</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###清除工作环境###
<span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###加载程序包###
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(scales)</code></pre></div>
<p><strong>任务一</strong></p>
<p>找到站点数据Divvy_Stations_2016_Q1Q2和行程数据Divvy_Trips_2016_04。读入样本数据，分别命名为station和trip。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###读入文件中的数据###
station &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Divvy_Stations_2016_Q1Q2.csv&quot;</span>)        <span class="co">#站点数据station</span>
trip &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Divvy_Trips_2016_04.csv&quot;</span>)                <span class="co">#行程数据trip</span></code></pre></div>
<p><strong>任务二</strong></p>
<p>将station表的online_date列转换为日期型，将trip表的starttime列和stoptime列分别转换为日期时间型（可用as.POSIXct或lubridate包的mdy_hm函数）。构造三个新列，分别为行程开始时间starttime的小时数，行程结束时间的小时数，行程开始时间增加10分钟得到的时间，分别命名为starttime_h，stoptime_h和t。用summary函数统计数据概况，尝试解读结果，给出你的分析。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###转换日期数据###
station<span class="op">$</span>online_date &lt;-<span class="st"> </span><span class="kw">mdy</span>(station<span class="op">$</span>online_date)         <span class="co">#station表online_date格式转换</span>
trip<span class="op">$</span>starttime &lt;-<span class="st"> </span><span class="kw">mdy_hm</span>(trip<span class="op">$</span>starttime)                <span class="co">#trip表starttime和stoptime格式转换</span>
trip<span class="op">$</span>stoptime &lt;-<span class="st"> </span><span class="kw">mdy_hm</span>(trip<span class="op">$</span>stoptime)

###添加新的三列###
trip &lt;-<span class="st"> </span><span class="kw">data.table</span>(trip)
trip[,<span class="kw">c</span>(<span class="st">&quot;starttime_h&quot;</span>,<span class="st">&quot;stoptime_h&quot;</span>,<span class="st">&quot;t&quot;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(<span class="kw">hour</span>(starttime),<span class="kw">hour</span>(stoptime),starttime <span class="op">+</span><span class="st"> </span><span class="kw">minutes</span>(<span class="dv">10</span>))]
<span class="kw">summary</span>(trip)                                         <span class="co">#查看trip数据结果</span></code></pre></div>
<pre><code>##     trip_id          starttime                  
##  Min.   :9080553   Min.   :2016-04-01 00:04:00  
##  1st Qu.:9159400   1st Qu.:2016-04-12 18:14:00  
##  Median :9230085   Median :2016-04-17 20:12:00  
##  Mean   :9230978   Mean   :2016-04-17 15:11:03  
##  3rd Qu.:9304310   3rd Qu.:2016-04-23 19:05:00  
##  Max.   :9379901   Max.   :2016-04-30 23:59:00  
##                                                 
##     stoptime                       bikeid    
##  Min.   :2016-04-01 00:09:00   Min.   :   1  
##  1st Qu.:2016-04-12 18:26:00   1st Qu.:1317  
##  Median :2016-04-17 20:39:00   Median :2595  
##  Mean   :2016-04-17 15:26:46   Mean   :2531  
##  3rd Qu.:2016-04-23 19:25:00   3rd Qu.:3773  
##  Max.   :2016-05-01 14:55:00   Max.   :4837  
##                                              
##   tripduration   from_station_id
##  Min.   :   60   Min.   :  2    
##  1st Qu.:  381   1st Qu.: 75    
##  Median :  656   Median :158    
##  Mean   :  942   Mean   :177    
##  3rd Qu.: 1114   3rd Qu.:268    
##  Max.   :86186   Max.   :511    
##                                 
##                     from_station_name  to_station_id
##  Streeter Dr &amp; Grand Ave     :  3860   Min.   :  2  
##  Clinton St &amp; Washington Blvd:  3588   1st Qu.: 74  
##  Lake Shore Dr &amp; Monroe St   :  3176   Median :157  
##  Clinton St &amp; Madison St     :  2760   Mean   :177  
##  Theater on the Lake         :  2549   3rd Qu.:268  
##  Canal St &amp; Adams St         :  2486   Max.   :511  
##  (Other)                     :213216                
##                      to_station_name  
##  Streeter Dr &amp; Grand Ave     :  4624  
##  Canal St &amp; Madison St       :  3205  
##  Clinton St &amp; Washington Blvd:  3131  
##  Lake Shore Dr &amp; Monroe St   :  3039  
##  Theater on the Lake         :  2672  
##  Clinton St &amp; Madison St     :  2528  
##  (Other)                     :212436  
##        usertype         gender         birthyear    
##  Customer  : 49392         : 49418   Min.   :1899   
##  Subscriber:182243   Female: 42947   1st Qu.:1974   
##                      Male  :139270   Median :1983   
##                                      Mean   :1980   
##                                      3rd Qu.:1988   
##                                      Max.   :2000   
##                                      NA&#39;s   :49392  
##   starttime_h     stoptime_h  
##  Min.   : 0.0   Min.   : 0.0  
##  1st Qu.:10.0   1st Qu.:10.0  
##  Median :14.0   Median :15.0  
##  Mean   :13.6   Mean   :13.8  
##  3rd Qu.:17.0   3rd Qu.:17.0  
##  Max.   :23.0   Max.   :23.0  
##                               
##        t                      
##  Min.   :2016-04-01 00:14:00  
##  1st Qu.:2016-04-12 18:24:00  
##  Median :2016-04-17 20:22:00  
##  Mean   :2016-04-17 15:21:03  
##  3rd Qu.:2016-04-23 19:15:00  
##  Max.   :2016-05-01 00:09:00  
## </code></pre>
<p><strong>分析</strong></p>
<p>从summary的结果可以看出，行程开始时间和结束时间的5-numbers较为相近，说明共享单车的借车和换车时间比较集中。</p>
<p>按照计算的小时数来看，均值都在下午一点多，中位数比均值更晚，分别为下午两点和下午三点，因此形成开始和结束的时间都呈现左偏的特征。</p>
<p>下午一点至三点一般是学生上学的时间，也是后半天的工作开始时间，可能有大量的居民使用单车；对于游客来说，吃完午饭开始游玩也正是这个时间，因此使用量较大。</p>
<p>行程时间平均水平为942.5s，中位数小于均值，分布呈现右偏特征，即大多数用户使用共享单车都是短时间的，这也符合共享单车解决“最后一公里”的初衷。</p>
<p><strong>任务三</strong></p>
<p>输出站点规模概况（summary）并绘制直方图。一个共享单车站点可以停几辆单车呢？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###查看站点规模###
<span class="kw">summary</span>(station<span class="op">$</span>dpcapacity)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    11.0    15.0    15.0    17.2    19.0    47.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###绘制站点规模直方图###
<span class="kw">ggplot</span>(station, <span class="kw">aes</span>(<span class="dt">x=</span>dpcapacity)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="dv">5</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(<span class="dv">10</span>, <span class="dv">50</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;车桩数&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;频数&quot;</span>)</code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p><strong>分析</strong></p>
<p>站点规模明显右偏，由于均值容易受异常值影响，因此参考中位数更为科学。由结果可以看出，平均站点规模为一个站点停放15辆共享单车。而一个站点15辆车也符合日常看到的共享单车站点情况。</p>
<p><strong>任务四</strong></p>
<p>请按用户类型统计行程数，输出条形图。这个工作自行车系统，从使用量上来讲，哪个人群是主力呢，贡献了百分之多少的流量呢？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###统计不同类型用户的行程数###
<span class="kw">ggplot</span>(trip, <span class="kw">aes</span>(<span class="dt">x=</span>usertype)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;count&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;steelblue4&quot;</span>)  <span class="op">+</span><span class="kw">scale_x_discrete</span>(<span class="dt">name=</span><span class="st">&#39;用户类型&#39;</span>, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&#39;游客&#39;</span>,<span class="st">&#39;居民&#39;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span><span class="st">&#39;出行数量&#39;</span>)  <span class="co">#绘制直方图</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">table</span>(trip<span class="op">$</span>usertype)<span class="op">/</span><span class="kw">length</span>(trip<span class="op">$</span>usertype)
<span class="kw">percent</span>(<span class="kw">as.vector</span>(a), <span class="dt">accuracy =</span> <span class="fl">0.01</span>)                  <span class="co">#两类用户贡献流量占比，保留两位小数</span></code></pre></div>
<pre><code>## [1] &quot;21.32%&quot; &quot;78.68%&quot;</code></pre>
<p><strong>分析</strong></p>
<p>这个工作自行车系统，从使用量上来讲，主力是居民，贡献了78.68%的流量。</p>
<p>居民在工作日上下班、上下学的途中会大量使用共享单车，而在周末也会贡献一部分力量；游客更多会在节假日游玩时使用共享单车，因此并不是单车使用的主力。</p>
<p><strong>任务五</strong></p>
<p>自行车的命运是否也有不同呢？统计每辆自行车的使用次数，得到自行车日均使用次数直方图，并尝试解读。提示：平均每辆自行车一个内会会被使用几次呢？最小值，四分之一位数，中位数，四分之三位数，最大值又是多少？从这个角度看，你觉得这个共享单车系统的单车使用率怎么样？高还是低？说说你的分析。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trip[,monthlyuse <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">length</span>(trip_id), by =<span class="st"> &quot;bikeid&quot;</span>]   <span class="co">#统计每一辆自行车的月均使用次数（频数）</span>
bikeuseid &lt;-<span class="st"> </span><span class="kw">unique</span>(trip[,.(bikeid,monthlyuse)])      <span class="co">#保证原数据框不被更改，新建bikeuseid数据框</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###查看每辆自行车月均使用频率###
<span class="kw">summary</span>(bikeuseid<span class="op">$</span>monthlyuse)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       1      35      52      51      67     184</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###绘制每辆自行车月均使用次数直方图###
<span class="kw">ggplot</span>(bikeuseid, <span class="kw">aes</span>(<span class="dt">x=</span>monthlyuse)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="dv">10</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;自行车日均使用次数&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;频率&quot;</span>)</code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p><strong>分析</strong></p>
<p>根据数据结果，平均每一辆自行车一个月内会被使用51.05次，其5-number特征数如上所示。</p>
<p>虽然最高的使用频率是一个月184次，即一天6次，但是一辆共享单车平均每天只会被使用不到2次。从这个角度来看，此共享单车系统的使用率偏低。</p>
<p><strong>任务六</strong></p>
<p>请按天分析一日的时均借车量和还车量并绘制直方图，并解读结果。提示：共享单车的使用是否有早晚高峰，若有，分别是几点呢？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###绘制时均借车量直方图###
trip[,usehour <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">hour</span>(starttime)]                     <span class="co">#借车的小时index</span>
trip[,hourlyuse <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">length</span>(trip_id), by =<span class="st"> &quot;usehour&quot;</span>]   <span class="co">#每个小时借车的数量</span>
startuse &lt;-<span class="st"> </span><span class="kw">unique</span>(trip[,.(usehour,hourlyuse)])       <span class="co">#得到绘制条形图的数据框</span>
<span class="kw">ggplot</span>(startuse,<span class="kw">aes</span>(<span class="dt">x =</span> usehour, <span class="dt">y =</span> hourlyuse)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;使用小时&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;借车量&quot;</span>)                    <span class="co">#绘制时均借车量直方图</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###绘制时均还车量直方图###
trip[,backhour <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">hour</span>(stoptime)]                     <span class="co">#还车的小时index</span>
trip[,hourlyback <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">length</span>(trip_id), by =<span class="st"> &quot;backhour&quot;</span>]  <span class="co">#每个小时还车的数量</span>
stopuse &lt;-<span class="st"> </span><span class="kw">unique</span>(trip[,.(backhour,hourlyback)])       <span class="co">#得到绘制条形图的数据框</span>
<span class="kw">ggplot</span>(stopuse,<span class="kw">aes</span>(<span class="dt">x =</span> backhour, <span class="dt">y =</span> hourlyback)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;使用小时&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;还车量&quot;</span>)                   <span class="co">#绘制时均还车量直方图</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<p><strong>分析</strong></p>
<p>根据直方图，共享单车的借车和还车都具有早晚高峰。对于借车、还车来说，早高峰都为早上8点，晚高峰都为下午5点，并且晚高峰时段借还车量都大于早高峰。早晚高峰时间正好是上下班、上下学的时间，结果符合预期。</p>
<p>对于早高峰的还车量较多，一个推测是：通常上班族会在临近上班的时间到达目的地，因此还车量在这个时刻会很高，而出发时间取决于其居住地点的远近，因此借车量没有还车量高。</p>
<p><strong>任务七</strong></p>
<p>分用户类型统计周内日均还车量。至此，你应该充分掌握了绘制条形图的方法，尝试将游客和居民的周内日均还车量绘制成条形图。理解不同用户类型的出行特点并解读。提示，工作日使用单车多，还是非工作日多？不同人群一样吗？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###定义绘制某类用户周内日均还车量直方图的函数###
<span class="kw">detach</span>(<span class="st">&quot;package:data.table&quot;</span>)                                <span class="co">#由于&quot;data.table&quot;和&quot;lubridate&quot;有共同的函数，因此临时detach一个包</span>
PlotUserBack &lt;-<span class="st"> </span><span class="cf">function</span>(usertype){                         <span class="co">#绘制日均还车量（星期）条形图函数</span>
  subtrip &lt;-<span class="st"> </span>trip[trip<span class="op">$</span>usertype <span class="op">==</span><span class="st"> </span>usertype,]               <span class="co">#选出不同类型的骑车人</span>
  day_in_week &lt;-<span class="st"> </span><span class="kw">c</span>()
  day_in_week &lt;-<span class="st"> </span><span class="kw">wday</span>(subtrip<span class="op">$</span>stoptime,<span class="dt">label =</span> T)           <span class="co">#取出还车时间的星期</span>
  sub_back_date &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">date =</span> day_in_week)           <span class="co">#设置还车星期数据框</span>
  sub_back_date<span class="op">$</span>date =<span class="st"> </span><span class="kw">factor</span>(sub_back_date<span class="op">$</span>date, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&#39;周一&#39;</span>,<span class="st">&#39;周二&#39;</span>,<span class="st">&#39;周三&#39;</span>,<span class="st">&#39;周四&#39;</span>,<span class="st">&#39;周五&#39;</span>,<span class="st">&#39;周六&#39;</span>,<span class="st">&#39;周日&#39;</span>)) <span class="co">#重新对星期level排序</span>
  <span class="kw">ggplot</span>(sub_back_date, <span class="kw">aes</span>(<span class="dt">x=</span>date)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;count&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;steelblue4&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;星期&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;还车量&quot;</span>)                                       <span class="co">#绘制一周内日均还车量直方图</span>
}   

<span class="kw">PlotUserBack</span>(<span class="st">&quot;Subscriber&quot;</span>)                                    <span class="co">#绘制居民日均还车量</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">PlotUserBack</span>(<span class="st">&quot;Customer&quot;</span>)                                        <span class="co">#绘制游客日均还车量</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)                                         <span class="co">#再library回刚才的data.table包</span></code></pre></div>
<p><strong>分析</strong></p>
<p>还车量可以代表出行数量，由直方图可以看出，不同类型的用户具有不同的出行时间特点。</p>
<p>居民的出行量整体高于游客使用共享单车的出行量，这和居民和用户本身的数量有关。居民在工作日（周一至周五）还车量较多，多数用于上下班和上学、放学；而游客在周六和周日出行较多，多数用于游玩——这表现出不同类型的用户使用共享单车的目的不同。</p>
<p><strong>任务八</strong></p>
<p>统计用户出行时长分布，并计算按出行时长排序后，对应行程数占比的累计值，绘图并分析，这里你将学着分析累计密度图。提示：短行程多还是长行程多？是否有类似二八定律的发现？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###计算用户出行时长，单位为分钟###
trip[,trip_use_time <span class="op">:</span><span class="er">=</span><span class="st"> </span>tripduration<span class="op">/</span><span class="dv">60</span>]                                                  <span class="co">#转换出行时长单位为分钟</span>

###计算出行时长频数###
trip_use_time &lt;-<span class="st"> </span><span class="kw">table</span>(trip<span class="op">$</span>trip_use_time)                                                <span class="co">#统计频数</span>
trip_use_time &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">as.numeric</span>(<span class="kw">names</span>(trip_use_time)),<span class="kw">as.numeric</span>(trip_use_time))   <span class="co">#转换为数据框</span>
<span class="kw">colnames</span>(trip_use_time) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;time&quot;</span>,<span class="st">&quot;freq&quot;</span>)                                               <span class="co">#给数据框重命列名</span>
trip_use_time &lt;-<span class="st"> </span>trip_use_time[<span class="kw">order</span>(trip_use_time<span class="op">$</span>time),]                                <span class="co">#将频数按从小到大的顺序重新排列</span>

###计算出行时长累积频率###
use_time_freq &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
accumulate &lt;-<span class="st"> </span><span class="dv">0</span>

<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(trip_use_time)){                                                            <span class="co">#计算每一种出行时长的累积频数</span>
  accumulate &lt;-<span class="st"> </span>accumulate <span class="op">+</span><span class="st"> </span>trip_use_time[i,<span class="st">&quot;freq&quot;</span>]
  row &lt;-<span class="st"> </span><span class="kw">cbind</span>(trip_use_time<span class="op">$</span>time[i],accumulate)                                          <span class="co">#拼接数据框</span>
  use_time_freq &lt;-<span class="st"> </span><span class="kw">rbind</span>(use_time_freq,row)
}
totalfreq &lt;-<span class="st"> </span><span class="kw">sum</span>(trip_use_time<span class="op">$</span>freq)                                                        <span class="co">#总频数</span>
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(trip_use_time)){                                                            <span class="co">#计算每一种出行时长的累计频率</span>
  use_time_freq<span class="op">$</span>accu_pro[i] &lt;-<span class="st"> </span>use_time_freq<span class="op">$</span>accumulate[i]<span class="op">/</span>totalfreq
}
<span class="kw">colnames</span>(use_time_freq) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;time&quot;</span>,<span class="st">&quot;accu_num&quot;</span>,<span class="st">&quot;accu_pro&quot;</span>)                                <span class="co">#数据框重命列名</span>

###统计出行时长的5-numbers###
<span class="kw">quantile</span>(use_time_freq<span class="op">$</span>time,  <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="dv">1</span>))</code></pre></div>
<pre><code>##      0%     25%     50%     75%    100% 
##    1.00   28.03   55.25   93.55 1436.43</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###绘制出行时长累积密度曲线###
<span class="kw">ggplot</span>(use_time_freq) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> accu_pro)) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;出行时长（单位：分钟）&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;Pr[X&lt;x]&quot;</span>)</code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p><strong>分析</strong></p>
<p>累积分布曲线的斜率是概率密度，因此由图可以看出，行程每增加一分钟，数量增加的越来越少。行程符合“二八定律”，即行程短的数量多，行程较长的数量少。</p>
<p><strong>任务九</strong></p>
<p>这里你将学习如何把两张表的数据关联起来，得到新发现。分别打印出居民女性、居民男性和游客还车量前三的站点及其经纬度。猜猜这些站点流量大的原因是什么？提示：你可以借助网络，了解下这些站点及其地理位置。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###选出三种用户类型对应的trip子数据框###
sub_female &lt;-<span class="st"> </span>trip[((trip<span class="op">$</span>usertype <span class="op">==</span><span class="st"> &quot;Subscriber&quot;</span>)<span class="op">&amp;</span>(trip<span class="op">$</span>gender <span class="op">==</span><span class="st"> &quot;Female&quot;</span>)),]                      <span class="co">#女性居民</span>
sub_male &lt;-<span class="st"> </span>trip[((trip<span class="op">$</span>usertype <span class="op">==</span><span class="st"> &quot;Subscriber&quot;</span>)<span class="op">&amp;</span>(trip<span class="op">$</span>gender <span class="op">==</span><span class="st"> &quot;Male&quot;</span>)),]                          <span class="co">#男性居民</span>
customer &lt;-<span class="st"> </span>trip[trip<span class="op">$</span>usertype <span class="op">==</span><span class="st"> &quot;Customer&quot;</span>,]                                                        <span class="co">#游客</span>

###定义输出还车量前三的站点及其经纬度函数###
Top3Station &lt;-<span class="st"> </span><span class="cf">function</span>(usertype){                                                                    <span class="co">#usertype可以选择为sub_female, sub_male, customer</span>
usertype[,cnt <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">length</span>(trip_id), by =<span class="st"> &quot;to_station_id&quot;</span>]                                              <span class="co">#计算每个还车站点流量 </span>
to_station &lt;-<span class="st"> </span><span class="kw">unique</span>(usertype[,<span class="kw">c</span>(<span class="st">&quot;to_station_id&quot;</span>,<span class="st">&quot;to_station_name&quot;</span>,<span class="st">&quot;cnt&quot;</span>)])                         <span class="co">#每个站点的流量数据框</span>
<span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(to_station)){                                                                        <span class="co">#关联trip表和station表</span>
  to_station<span class="op">$</span>latitude[j] &lt;-<span class="st"> </span>station[<span class="kw">which</span>(station<span class="op">$</span>id <span class="op">==</span><span class="st"> </span>to_station<span class="op">$</span>to_station_id[j]),<span class="st">&quot;latitude&quot;</span>]    <span class="co">#按照station ID连接两张表，获取纬度</span>
  to_station<span class="op">$</span>longitude[j] &lt;-<span class="st"> </span>station[<span class="kw">which</span>(station<span class="op">$</span>id <span class="op">==</span><span class="st"> </span>to_station<span class="op">$</span>to_station_id[j]),<span class="st">&quot;longitude&quot;</span>]  <span class="co">#按照station ID连接两张表，获取经度</span>
}
to_station &lt;-<span class="st"> </span><span class="kw">arrange</span>(to_station,<span class="op">-</span>cnt)      <span class="co">#按照流量由大到小排序</span>
to_station[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>),<span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">5</span>)]       <span class="co">#输出流量前三的站点信息</span>
}

###打印出居民女性、居民男性和游客还车量前三的站点及其经纬度###
<span class="kw">Top3Station</span>(sub_female)     <span class="co">#女性居民Top3流量站点</span></code></pre></div>
<pre><code>##             to_station_name cnt latitude longitude
## 1     Dearborn St &amp; Erie St 382    41.89    -87.63
## 2 Wabash Ave &amp; Roosevelt Rd 379    41.87    -87.63
## 3  Kingsbury St &amp; Kinzie St 378    41.89    -87.64</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Top3Station</span>(sub_male)       <span class="co">#男性居民Top3流量站点</span></code></pre></div>
<pre><code>##                to_station_name  cnt latitude longitude
## 1        Canal St &amp; Madison St 2718    41.88    -87.64
## 2 Clinton St &amp; Washington Blvd 2713    41.88    -87.64
## 3      Clinton St &amp; Madison St 2062    41.88    -87.64</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Top3Station</span>(customer)       <span class="co">#游客Top3流量站点</span></code></pre></div>
<pre><code>##              to_station_name  cnt latitude longitude
## 1    Streeter Dr &amp; Grand Ave 3654    41.89    -87.61
## 2  Lake Shore Dr &amp; Monroe St 2485    41.88    -87.62
## 3 Lake Shore Dr &amp; North Blvd 1651    41.91    -87.63</code></pre>
<p><strong>分析</strong></p>
<p><strong>女性居民Top3站点</strong></p>
<p><strong>Top 1: Dearborn St &amp; Erie St</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274511-fc4d1710-9131-11e8-8b50-664bcb8944e3.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p><strong>Top 2: Wabash Ave &amp; Roosevelt Rd</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274512-fca1102c-9131-11e8-9d5c-ecec8ef383c1.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p><strong>Top 3: Kingsbury St &amp; Kinzie St</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274516-fd58cabe-9131-11e8-93ad-63412ad516ee.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p>由Google地图定位可以看出，女性居民最常使用共享单车的目的地杂货店、餐馆和健身俱乐部。</p>
<p><strong>男性居民Top3站点</strong></p>
<p><strong>Top 1: Canal St &amp; Madison St</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274517-fda93544-9131-11e8-8b36-b86e04f535c1.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p><strong>Top 2: Clinton St &amp; Washington Blvd</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274518-fe12ba1e-9131-11e8-96b5-8c94fe6cd03a.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p><strong>Top 3: Clinton St &amp; Madison St</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274520-fe665976-9131-11e8-9f29-697ee232dc06.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p>而男性居民最常见的还车点则集中在地铁站、公交车站等交通运输中心。</p>
<div id="top3" class="section level4">
<h4><span class="header-section-number">5.2.2.1</span> 游客Top3站点</h4>
<p><strong>Top 1: Streeter Dr &amp; Grand Ave</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274502-faee0e9c-9131-11e8-9cef-288041fb77c4.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p><strong>Top 2: Lake Shore Dr &amp; Monroe St</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274503-fb4265be-9131-11e8-8986-885ef5bb74fb.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p><strong>Top 3: Lake Shore Dr &amp; North Blvd</strong></p>
<div align="center">
<p><img src="https://user-images.githubusercontent.com/35906792/43274506-fb956548-9131-11e8-8cfc-9b7463297894.JPG" width=80% height=80% alt="tea-recruit"/></p>
</div>
<p>与居民不同，游客的共享单车还车点集中在博物馆、公园、码头以及美术馆，这体现了游客和居民使用共享单车的不同目的。</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="descriptive.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-chinese/edit/master/05-task-3.Rmd",
"text": "缂栬緫"
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
